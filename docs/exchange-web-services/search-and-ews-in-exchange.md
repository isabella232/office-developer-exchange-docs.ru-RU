---
title: Поиск и EWS в Exchange
manager: sethgros
ms.date: 09/17/2015
ms.audience: Developer
ms.localizationpriority: medium
ms.assetid: 9fa5b836-857e-401d-9450-51e7dbc69104
description: Узнайте, как искать элементы в Exchange с помощью управляемого API EWS или EWS.
ms.openlocfilehash: f78f4625880480e4f0d1ebb683c6e7c2c7fa83e0
ms.sourcegitcommit: 54f6cd5a704b36b76d110ee53a6d6c1c3e15f5a9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2021
ms.locfileid: "59524436"
---
# <a name="search-and-ews-in-exchange"></a>Поиск и EWS в Exchange

Узнайте, как искать элементы в Exchange с помощью управляемого API EWS или EWS.

Не похоже на этом? Наконец-то вы начинаете этот проект, который откладывается в течение нескольких недель, и вам потребуется информация о проекте, отправленного менеджером в электронной почте несколько недель назад. Ваш почтовый ящик имеет сотни или, возможно, тысячи сообщений в нем. Чем занимаешься? Прокрутите ли вы сканирование электронной почты каждого субъекта и отправитель, пока не найдете его? Или вы используете функцию поиска в любимом клиенте электронной почты, чтобы быстро обнулять то, что вам нужно?

Поиск, возможно, является обязательным элементом для любого клиента электронной почты. Но поиск можно использовать не только для того, чтобы пользователи могли искать почтовый ящик. Необходимо ли вашему приложению обрабатывать встречи, которые попадают в определенные периоды времени? Может быть, вам потребуется сообщить о всех пунктах задач с определенным состоянием или переместить все контакты с определенным именем компании в другую папку. Поиск может помочь со всеми этими требованиями.

## <a name="search-basics"></a>Основы поиска
<a name="bk_SearchBasics"> </a>

Управляемый API EWS и EWS предлагают два основных метода для указания поиска. Можно использовать фильтр [поиска или](how-to-use-search-filters-with-ews-in-exchange.md) [строку запроса.](how-to-perform-an-aqs-search-by-using-ews-in-exchange.md) Метод, который вы используете, зависит от намерения поиска.

**Таблица 1. Сценарии для фильтров поиска и поисковых запросов**

|**Задача**|**Использование...**|**Примечания**.|
|:-----|:-----|:-----|
|Ограничить поиск определенным свойством или набором свойств  <br/> |Фильтр поиска  <br/> |Фильтры поиска обеспечивают оптимальный уровень управления, на котором будут искаться свойства. Несмотря на то, что строки запросов могут быть нацелены на ограниченный набор свойств с помощью синтаксиса расширенных запросов (AQS), фильтры поиска могут нацелить любое свойство.  <br/> |
|Создание поиска с несколькими критериями  <br/> |Фильтр поиска  <br/> |С помощью фильтров поиска можно соединять несколько критериев поиска с логическими ИД или ORS, что позволяет искать, например, "тема содержит "Заметки о собраниях", а отправитель равен "Sadie Daniels". Хотя строки запросов также могут присоединяться к нескольким критериям поиска, они ограничены набором свойств, поддерживаемых строками запросов.  <br/> |
|Поиск пользовательских свойств  <br/> |Фильтр поиска  <br/> |Фильтры поиска могут настраивать настраиваемые свойства. Строки запросов не ищут настраиваемые свойства.  <br/> |
|Выполните конфиденциальный поиск свойств строк в случае  <br/> |Фильтр поиска  <br/> |Поиск строки запроса не является конфиденциальным.  <br/> |
|Управление режимом сдерживания при поиске свойств строки  <br/> |Фильтр поиска  <br/> |Поиск строки запросов — это всегда подстройка поиска. Если требуется поиск определенных префиксов или требуются точные совпадения, оптимальным выбором является фильтр поиска.  <br/> |
|Поиск папок  <br/> |Фильтр поиска  <br/> |EWS не поддерживает поиск папок со строкой запроса.  <br/> |
|Создание папки поиска  <br/> |Фильтр поиска  <br/> |EWS не поддерживает создание папки поиска со строкой запроса.  <br/> |
|Поиск по всем часто используемым свойствам  <br/> |Строка запроса  <br/> |Строки запроса, не содержащие AQS, будут искать все часто используемые свойства. Например, строка запроса "Mack Chaves" возвращает все сообщения, отправленные Mack Chaves, а также любые сообщения с "Mack Chaves" в теле или субъекте.  <br/> |
|Построение поиска на основе простого ввода пользователя  <br/> |Строка запроса  <br/> |Строка запроса — это отличный выбор, позволяющий конечному пользователю быстро искать, введя простую строку. Так как поиск строки запроса включает все часто используемые свойства, результаты будут содержать все элементы, содержащие термины поиска пользователя.  <br/> |

### <a name="using-a-search-filter"></a>Использование фильтра поиска

Фильтры поиска дают широкий спектр параметров поиска и наибольшую степень контроля над тем, как выполняется поиск. Вы можете использовать фильтры поиска для выполнения базового поиска равенства и сравнения, но вы также можете искать в содержимом свойств строки или делать bitmask сравнения.

Например, вы можете искать содержимое субъекта элементов с помощью класса [SearchFilter.ContainsSubstring](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.searchfilter.containssubstring%28v=exchg.80%29.aspx) в управляемом API EWS. В этом примере создается фильтр поиска для поиска субъекта для подстройки "заметки о собраниях", игнорируя случай.

```cs
SearchFilter.ContainsSubstring subjectFilter = new SearchFilter.ContainsSubstring(ItemSchema.Subject,
    "meeting notes", ContainmentMode.Substring, ComparisonMode.IgnoreCase);
```

Вы также можете искать по настраиваемой свойствам. В этом примере настраиваемая свойство **ItemIndex** для поиска значений больше 3.

```cs
Guid MyAppGuid = new Guid("{AA3DF801-4FC7-401F-BBC1-7C93D6498C2E}");
ExtendedPropertyDefinition customPropDefinition =
    new ExtendedPropertyDefinition(MyAppGuid, "ItemIndex", MapiPropertyType.Integer);
SearchFilter.IsGreaterThan customPropFilter =
    new SearchFilter.IsGreaterThan(customPropDefinition, 3);
```

Вы также можете объединить несколько фильтров поиска для создания более сложных поисков. Например, можно объединить два предыдущих фильтра с логическим и с помощью класса [SearchFilter.SearchFilterCollection.](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.searchfilter.searchfiltercollection%28v=exchg.80%29.aspx)

```cs
SearchFilter.SearchFilterCollection compoundFilter =
    new SearchFilter.SearchFilterCollection(LogicalOperator.And, subjectFilter, customPropFilter);
```

### <a name="using-a-query-string"></a>Использование строки запроса

Строки запросов предоставляют другой подход к поиску. Вы меньше контролируете поля, которые ищутся, и то, как выполняется поиск при поиске строки запроса. Не то, чтобы это было плохо! В некоторых случаях может потребоваться, так сказать, более широкая сеть.

Например, можно искать "заметки о собраниях" с помощью метода управляемого API [ExchangeService.FindItems](https://msdn.microsoft.com/library/jj223808%28v=exchg.80%29.aspx) EWS.

```cs
FindItemsResults<Item> results = service.FindItems(folder, "meeting notes", view);
```

Если сравнить результаты этого поиска с результатами поиска **SearchFilter.ContainsSubstring** ранее, этот поиск будет содержать больше результатов. Поиск фильтра поиска возвращает только элементы, которые имеют "заметки собрания" в субъекте, в то время как этот поиск возвращает элементы, которые имеют "заметки собрания" в теме, теле и других областях.

Давайте рассмотрим, как можно уточнить строку запроса, чтобы приблизиться к результатам, которые вы видите из фильтра поиска. С помощью AQS можно ограничить поиск темой.

```cs
FindItemsResults<Item> results = service.FindItems(folder, "subject:meeting notes", view);
```

Это ближе, но результаты по-прежнему не совсем то же самое. При использовании строки запроса с несколькими словами вы получите совпадения, даже если слова не указаны в том порядке, в который вы указываете, или даже если они не примыкают друг к другу. Со строкой запроса "subject:meeting notes" вы получите совпадения для "заметки о собрании", "заметки из собрания" и так далее. Для дальнейшей уточнения можно завернуть термины поиска в двойные кавычка, чтобы указать, что эта фраза нужна только вам.

```cs
FindItemsResults<Item> results = service.FindItems(folder, "subject:\"meeting notes\"", view);
```

## <a name="requesting-specific-properties-in-search-results"></a>Запрос определенных свойств в результатах поиска
<a name="bk_RequestSpecific"> </a>

По умолчанию результаты поиска будут содержать все свойства элементов, которые соответствуют поиску. В некоторых случаях это может быть нужно, но в большинстве случаев приложение требует только дискретного набора свойств. В этом случае необходимо ограничить набор свойств, которые возвращаются только для свойств, необходимых вашему приложению. В следующем примере класс [ItemView](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.itemview%28v=exchg.80%29.aspx) используется для ограничения возвращаемого свойства субъекта, даты и времени, полученного и ID элементов.

```cs
ItemView view = new ItemView(10);
// Creating a new PropertySet with this constructor includes
// ItemSchema.Id.
view.PropertySet = new PropertySet(ItemSchema.Subject, ItemSchema.DateTimeReceived);
```

## <a name="controlling-search-depth"></a>Управление глубиной поиска
<a name="bk_SearchDepth"> </a>

Настройка обхода в представлении контролирует глубину и область поиска.

**Таблица 2. Значения обхода поиска**

|**Значение Traversal**|**Относится к**|**Описание**|
|:-----|:-----|:-----|
|Shallow  <br/> |Элементы и папки  <br/> |Неглубокие поиски ограничиваются прямыми детьми поисковой папки.  <br/> |
|Deep  <br/> |Элементы (только с папками поиска) и папки  <br/> |Глубокий поиск повторно выполняет поиск в папке, которая выполняется поиск, и в подмостках.  <br/> |
|Связанные  <br/> |Элементы  <br/> |Связанные поиски включают только связанные элементы из поисковой папки. Связанные элементы — это скрытые элементы в папке.  <br/> |
|SoftDeleted  <br/> |Элементы и папки  <br/> |Этот тип обхода отстает. Поиск softDeleted включает только элементы, которые находятся в контейнере. Контейнер был заменен папкой [](https://docs.microsoft.com/exchange/policy-and-compliance/recoverable-items-folder/recoverable-items-folder) восстанавливаемых элементов в Exchange Online, Exchange Online в Office 365 и версиями Exchange начиная с Exchange 2010 года.  <br/> |

## <a name="managing-search-results"></a>Управление результатами поиска
<a name="bk_ManageSearchResults"> </a>

Управляемый API и EWS EWS также позволяют изменить то, как возвращаются результаты поиска. Вы можете использовать представления, чтобы указать, какие свойства включены в результаты, сортировать результаты и страницы результатов, чтобы получить только задаткое количество результатов в ответ. Вы также можете группить результаты по определенным значениям поля и управлять глубиной поиска, указав тип обхода. Наконец, вы можете использовать папки поиска для создания постоянных поисков, которые обновляются динамически по мере поступления новых элементов.

### <a name="sorting"></a>сортировке;

Вы можете получить сервер, чтобы вернуть отсортировали результаты, которые могут упростить отображение или обработку элементов в порядке. В этом примере результаты будут сортироваться по дате и времени, а самые новые элементы будут первыми.

```cs
view.OrderBy.Add(ItemSchema.DateTimeReceived, SortDirection.Descending);
```

### <a name="paging"></a>Разбиение на страницы

При отправке запроса на поиск с помощью управляемого API EWS или EWS указывается размер представления, который контролирует максимальное количество возвращенных элементов. Однако количество элементов на сервере, которые соответствуют вашему поиску, может быть больше размера представления. В этом случае сервер указывает, что доступны дополнительные элементы. Вы можете [использовать paging, чтобы повторить поиск](how-to-perform-paged-searches-by-using-ews-in-exchange.md) и получить следующий набор результатов.

Например, можно отправить запрос на поиск с размером представления 10. На сервере может быть 15 элементов, которые соответствуют вашему поиску, но вы получите только первые 10, а также индикатор [(FindItemsResults. \<TItem\> Свойство MoreAvailable,](https://msdn.microsoft.com/library/dd635477%28v=exchg.80%29.aspx) если вы используете управляемый API EWS), на сервере больше результатов. Затем можно отправить один и тот же поиск с смещением в 10, чтобы попросить следующие 10 элементов, которые соответствуют вашему поиску. Сервер возвращает оставшиеся пять элементов.

**Рис. 1. Пример поиска на странице**

![Изображение постраничного поиска. Изначально отправляется запрос на 10 элементов, а затем — запрос на следующие 10 элементов.](media/Ex15_Search_PagedSearch.png)

### <a name="grouping"></a>Группирование

 Exchange позволяет сгруппить результаты поиска по определенному полю. Это может помочь разбить результаты поиска на более управляемые наборы. Например, можно искать "заметки о собраниях" и группу результатов отправив. Как показано на следующем рисунке, возвращенные элементы будут разделены на группы, при этом все элементы, которые соответствуют критериям одного отправщика в одной группе, все совпадающие элементы из другого отправитель в другой группе и так далее.

**Рис. 2. Результаты поиска сгруппировали по отправителю**

![Изображение результатов поиска, сгруппированных по отправителям.](media/Ex15_Search_GroupedResults.png)

## <a name="search-folders"></a>Папки поиска
<a name="bk_SearchFolders"> </a>

При регулярном поиске выполняется поиск, результаты возвращаются в приложение для обработки, и поиск перестает существовать. Папки поиска предоставляют способ сделать поиск настойчивым. Это отличный вариант для поиска, который необходимо выполнить несколько раз. Вместо того, чтобы выполнять один и тот же поиск несколько раз, в результате чего сервер каждый раз оценивает поиск с нуля, папка поиска выполняет поиск всегда, что позволяет серверу обновлять существующий набор результатов при добавлении или удалении элементов из области поиска. Папки поиска действуют как обычные папки, в которых они отображаются как папки, в которых есть элементы. Разница заключается в том, что только элементы, содержащиеся в папке, соответствуют критериям поиска, связанным с папкой. После создания папки поиска приложение может получить последние результаты поиска, только проверив содержимое папки.

Создание папки поиска просто, когда вы освоили создание фильтров поиска. В следующем примере создается папка поиска, чтобы показать все сообщения электронной почты с темой, содержащем "заметки о собраниях".

```cs
static void CreateSearchFolder(ExchangeService service)
{
    SearchFilter.ContainsSubstring subjectFilter = new SearchFilter.ContainsSubstring(ItemSchema.Subject,
        "meeting notes", ContainmentMode.Substring, ComparisonMode.IgnoreCase);
    SearchFolder searchFolder = new SearchFolder(service);
    searchFolder.DisplayName = "Meeting Notes";
    searchFolder.SearchParameters.RootFolderIds.Add(WellKnownFolderName.Inbox);
    searchFolder.SearchParameters.Traversal = SearchFolderTraversal.Deep;
    searchFolder.SearchParameters.SearchFilter = subjectFilter;
    searchFolder.Save(WellKnownFolderName.SearchFolders);
}
```

## <a name="in-this-section"></a>В этом разделе:
<a name="bk_InThisSection"> </a>

- [Используйте фильтры поиска с помощью EWS в Exchange](how-to-use-search-filters-with-ews-in-exchange.md)

- [Выполните поиск AQS с помощью EWS в Exchange](how-to-perform-an-aqs-search-by-using-ews-in-exchange.md)

- [Выполнение страничного поиска с помощью EWS в Exchange](how-to-perform-paged-searches-by-using-ews-in-exchange.md)

- [Выполните групповые поиски с помощью EWS в Exchange](how-to-perform-grouped-searches-by-using-ews-in-exchange.md)

- [Работа с папками поиска с помощью EWS в Exchange](how-to-work-with-search-folders-by-using-ews-in-exchange.md)

## <a name="see-also"></a>См. также


- [Разработка клиентов веб-служб для Exchange](develop-web-service-clients-for-exchange.md)

- [Папка извлекаемых элементов](https://docs.microsoft.com/exchange/policy-and-compliance/recoverable-items-folder/recoverable-items-folder)

- [ExchangeService.FindItems](https://msdn.microsoft.com/library/microsoft.exchange.webservices.data.exchangeservice.finditems%28v=exchg.80%29.aspx)

- [Регулирование параметров политики, влияющих на операции поиска EWS](ews-throttling-in-exchange.md#throttling-policy-parameters-that-affect-ews-search-operations)
