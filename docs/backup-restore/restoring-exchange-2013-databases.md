---
title: Восстановление Exchange 2013 г.
manager: sethgros
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
ms.prod: office-online-server
ms.localizationpriority: medium
ms.assetid: e0804bb1-fd66-448a-b2cb-9ae2726ae888
description: Сведения о различных способах восстановления баз данных Exchange 2013 г.
ms.openlocfilehash: 522128026bcbef893ce4909174d3fd9a95f1e8a9
ms.sourcegitcommit: 54f6cd5a704b36b76d110ee53a6d6c1c3e15f5a9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2021
ms.locfileid: "59513278"
---
# <a name="restoring-exchange-2013-databases"></a>Восстановление Exchange 2013 г.

Сведения о различных способах восстановления баз данных Exchange 2013 г. 
  
**Применяется к:** Exchange Server 2013 г. 
  
Автор Exchange, включенный в Exchange Server 2013 г., обеспечивает определенную гибкость в восстановлении Exchange баз данных. С помощью Exchange в Exchange 2013 г. можно восстановить резервные копии теневых копий в следующих расположениях:
  
- Исходная база данных независимо от того, была ли изменена конфигурация пути входа в базу данных или журнал транзакций.
    
- База данных восстановления.
    
- Любая производственная база данных независимо от того, совпадает ли имя отображения базы данных с именем в резервном наборе VSS.
    
Когда приложение восстановления восстанавливает сведения в исходной базе данных, файлы журналов должны быть восстановлены в пути каталога, указанному в службе домена Active Directory (AD DS) для этой базы данных. Если приложение восстанавливает базу данных в другом расположении, файлы журнала  должны быть восстановлены в папке с именем _restoredLogs, которая находится в каталоге файлов журнала баз данных. 
  
При восстановлении на сервере или базе данных, отличающихся от исходной базы данных, ваше приложение восстановления должно убедиться, что пути каталога баз данных, предоставляемые VSS, соответствуют путям в AD DS. Вы можете использовать [команды get-MailboxDatabase](https://technet.microsoft.com/library/bb124924%28v=exchg.150%29.aspx)Exchange Management Shell для получения сведений о существующих базах данных. Для получения дополнительных сведений о командной консоли Exchange см. статью [Exchange Server PowerShell (командная консоль Exchange)](https://docs.microsoft.com/powershell/exchange/exchange-server/exchange-management-shell?view=exchange-ps). 
  
На следующем рисунке показана последовательность событий в типичном восстановлении Exchange базы данных, управляемой службой копирования теней тома (VSS).
  
**Рис. 1. Последовательность событий для восстановления баз данных**

![Диаграмма, показывающая последовательность событий для процесса восстановления. Последовательность начинается с запуска хранилищ Exchange, после чего службой записи Exchange, VSS и клиентским приложением выполняется ряд действий.](media/VSS_StoreWriterRestore.gif)
  
## <a name="restoring-exchange-databases-to-the-original-location"></a>Восстановление Exchange баз данных в исходное расположение
<a name="bk_OriginalLocation"> </a>

Автор Exchange позволяет приложениям восстанавливать базы данных и файлы журналов транзакций в исходные расположения на Exchange сервере. По умолчанию Exchange записи записи транзакций после того, как запрашиватель подтвердит, что восстановление завершено во время операции [OnPostRestore.](https://msdn.microsoft.com/library/windows/desktop/aa381566%28v=vs.85%29.aspx) Приложение восстановления должно использовать метод VSS [SetAdditionalRestores,](https://msdn.microsoft.com/library/windows/desktop/aa382829%28v=vs.85%29.aspx) чтобы предотвратить повторение файлов журнала. Файлы журнала можно повторить позже, когда администратор Exchange или ваше приложение перенаправление восстановленной базы данных. 
  
При восстановлении баз данных к исходным объектам базы данных (таким образом, целевые GUID в базе данных совпадают с теми, которые находятся в наборе резервных копий), но для различных путей файлов приложение должно определить текущие пути файлов и восстановить файлы резервного копирования в соответствующие пути файлов, указанные в свойствах базы данных. Запрашиватель должен вызвать метод [AddNewTarget,](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx) чтобы сообщить автору Exchange, где восстанавливаются файлы, прежде чем писатель сможет продолжить весь остальной процесс восстановления. Если **AddNewTarget** не называется, Exchange предполагает, что резервные копии восстанавливаются в пути файлов, указанных в документе метаданных резервного копирования. 
  
Как правило, приложению не нужно указывать новый путь для резервного копирования, выполняемых из копии группы доступности баз данных (DAG). Exchange администраторы обычно не меняют пути баз данных или файлов журналов. Однако в конфигурации DAG приложению резервного копирования может потребоваться указать активные пути базы данных и журналов, так как пути копирования DAG всегда отличаются от этих путей.
  
Обратите внимание, Exchange 2013 г. не поддерживает восстановление неактивных копий баз данных DAG. Копии DAG можно восстановить из резервных данных только при восстановлении активной копии базы данных. Использование различных наборов данных резервного копирования или попытка восстановления подмножество копий баз данных может привести к тому, что база данных станет неподстановимой. В этом случае приложениям резервного копирования не нужно вызывать функцию [SetRestoreOptions,](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx) так как резервные копии восстанавливаются в исходных объектах базы данных, из них были созданы. Однако если резервное приложение вызывает **SetRestoreOptions** и документ метаданных XML имеет правильные параметры, результат не является ошибкой. 
  
## <a name="restoring-exchange-databases-to-a-recovery-database"></a>Восстановление Exchange баз данных в базу данных восстановления
<a name="bk_RecoveryDatabase"> </a>

Автор Exchange позволяет восстанавливать данные непосредственно в базе данных восстановления. Установка восстановленных данных в качестве базы данных восстановления позволяет администратору Exchange восстановить отдельные почтовые ящики и даже отдельные элементы в почтовом ящике.
  
Если база данных восстановления уже существует, приложение может демонтировать базу данных, восстановить данные в базе данных восстановления и файлах журналов, а затем перенавести базу данных.
  
Каждый Exchange 2013 года позволяет одновременно смонтировать только одну базу данных восстановления. Сервер может содержать столько восстановленных баз данных, сколько позволяет пространство диска, но только одна может быть установлена в качестве базы данных восстановления. База данных, установленная в качестве базы данных восстановления, подсчитываются в максимальном количестве баз данных, которые могут быть установлены одновременно. Восстановленная база данных, установленная в качестве базы данных восстановления сервера, ни в какой мере не связана с исходным почтовым ящиком.
  
Чтобы восстановить базу данных восстановления, приложение должно вызвать метод [SetRestoreOptions](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx) и предоставить XML-документ, который указывает исходные и целевые GUID базы данных. Исходные GUID-коды должны соответствовать данным из набора резервных копий, а целевые GUID должны совпадать с записями баз данных назначения в AD DS. Приложение резервного копирования также должно вызвать [метод AddNewTarget,](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx) чтобы указать путь каталога, куда восстанавливаются файлы. Если файлы баз данных необходимо переименовать, Exchange автор будет переименовывать базу данных во время операции [OnPostRestore.](https://msdn.microsoft.com/library/windows/desktop/aa381566%28v=vs.85%29.aspx) Exchange требует восстановления файлов журнала транзакций в подмостки **(_restoredLogs)** по текущему пути файла журнала транзакций. Если файлы журнала будут восстановлены в любом другом расположении, Exchange автор возвращает ошибку. Так как базы данных, устанавливаемые по мере восстановления базы данных восстановления, не восстанавливаются в исходном расположении, их необходимо привести в состояние очистки перед их монтажом. По умолчанию автор Exchange приведет все восстановленные базы данных в состояние очистки при восстановлении. Если приложение резервного копирования вызывает метод [SetAdditionalRestores,](https://msdn.microsoft.com/library/windows/desktop/aa382829%28v=vs.85%29.aspx) Exchange автор не будет переигрывать файлы журнала, и администратору или приложению резервного копирования необходимо привести базу данных в состояние очистки перед монтажом базы данных. 
  
## <a name="restoring-exchange-databases-to-a-recovery-server"></a>Восстановление Exchange баз данных на сервер восстановления
<a name="bk_RecoveryServer"> </a>

В некоторых сценариях может потребоваться восстановление резервного набора на другой сервер; Например, может потребоваться восстановление после катастрофического сбоя сервера путем переноса базы данных почтовых ящиков на другой сервер Exchange 2013 г. в той же организации Exchange или восстановление выделенного сервера за пределами производственной среды для восстановления данных почтовых ящиков и общедоступных папок. 
  
В этих сценариях пути файлов для целевой базы данных, а также ее объектные GUID-интерфейсы отличаются от путей исходной базы данных. Поэтому вашему приложению необходимо вызвать метод [SetRestoreOptions](https://msdn.microsoft.com/library/windows/desktop/aa382856%28v=vs.85%29.aspx) с XML-документом, который указывает источник и целевые данные базы данных, и вызвать метод [AddNewTarget,](https://msdn.microsoft.com/library/windows/desktop/aa382648%28v=vs.85%29.aspx) чтобы указать пути каталога для восстановления файлов резервного копирования. Для автора Exchange это восстановление такое же, как восстановление базы данных восстановления. Дополнительные сведения см. в [статье Восстановление Exchange базы](restoring-exchange-2013-databases.md#bk_RecoveryDatabase) данных в базу данных восстановления в начале этой статьи. 
  
## <a name="see-also"></a>См. также
<a name="bk_AdditionalResources"> </a>

- [Типы операций резервного копирования Exchange 2013 г.](types-of-backup-operations-for-exchange-2013.md)
    
- [Создание приложений резервного копирования и восстановления для Exchange 2013 г.](build-backup-and-restore-applications-for-exchange-2013.md)
    
- [Концепции резервного копирования и восстановления Exchange 2013 г.](backup-and-restore-concepts-for-exchange-2013.md)
    
- [Справочник по классу CChkSGFiles](cchksgfiles-class-reference.md)
    

